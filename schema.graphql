# Global launchpad stats
type Launchpad @entity(immutable: false) {
  id: ID!
  totalRigs: BigInt!
  totalRevenue: BigDecimal! # Total treasury revenue across all rigs
  totalMinted: BigDecimal!
  protocolRevenue: BigDecimal! # Platform revenue (1% protocol fees)
  rigs: [Rig!]! @derivedFrom(field: "launchpad")
}

# A mining rig instance deployed via the launchpad
type Rig @entity(immutable: false) {
  id: ID!
  launchpad: Launchpad!
  launcher: Account!
  unit: Bytes!
  auction: Bytes!
  lpToken: Bytes!
  tokenName: String!
  tokenSymbol: String!
  uri: String!
  # Launch parameters
  initialUps: BigInt!
  tailUps: BigInt!
  halvingPeriod: BigInt!
  rigEpochPeriod: BigInt!
  rigPriceMultiplier: BigDecimal!
  rigMinInitPrice: BigDecimal!
  # Runtime state
  epochId: BigInt!
  revenue: BigDecimal! # Treasury revenue (15% fees to auction)
  teamRevenue: BigDecimal! # Team revenue (4% fees)
  minted: BigDecimal!
  lastMined: BigInt!
  createdAt: BigInt!
  createdAtBlock: BigInt!
  epochs: [Epoch!]! @derivedFrom(field: "rig")
}

# User account (global identity)
type Account @entity(immutable: false) {
  id: ID!
  rigsLaunched: [Rig!]! @derivedFrom(field: "launcher")
  rigAccounts: [RigAccount!]! @derivedFrom(field: "account")
}

# User participation on a specific rig
type RigAccount @entity(immutable: false) {
  id: ID! # {rigAddress}-{accountAddress}
  rig: Rig!
  account: Account!
  spent: BigDecimal! # WETH spent mining on this rig
  earned: BigDecimal! # WETH earned from previous miner fees
  mined: BigDecimal! # Unit tokens minted on this rig
  epochs: [Epoch!]! @derivedFrom(field: "rigAccount")
}

# A single mining epoch on a rig
type Epoch @entity(immutable: false) {
  id: ID! # {rigAddress}-{epochId}
  rig: Rig!
  rigAccount: RigAccount!
  uri: String!
  startTime: BigInt!
  initPrice: BigDecimal!
  mined: BigDecimal! # Unit tokens minted this epoch
  spent: BigDecimal! # WETH spent this epoch
  earned: BigDecimal! # WETH earned this epoch (previous miner fee)
}
